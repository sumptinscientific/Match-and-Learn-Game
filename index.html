# Generate an upgraded, mobile-friendly Sumptin' Scientific match game with footer, topics, sounds, settings,
# local high scores, device leaderboard, share button, and a clear extension point for online leaderboards.

html = r"""<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Sumptin‚Äô Scientific ‚Äî Match & Learn</title>
<meta name="theme-color" content="#0f4a4e">
<style>
  :root{
    --bg:#0f4a4e;        /* deep teal */
    --panel:#0b3b3f;    /* darker teal */
    --cream:#f6ecd6;    /* warm cream for text */
    --amber:#d08a1b;    /* warm amber (distinct from bright yellow) */
    --mint:#6ab9b6;     /* accent teal */
    --correct:#2aa36b;
    --wrong:#d34b57;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--cream);
    font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    -webkit-tap-highlight-color: transparent;
  }
  header{
    padding:14px 16px;
    display:flex;gap:12px;align-items:center;justify-content:space-between;
    background:linear-gradient(180deg,var(--panel),transparent);
    position:sticky;top:0;z-index:10;
    border-bottom:1px solid rgba(255,255,255,.07);
  }
  .brand{display:flex;gap:10px;align-items:center;font-weight:800;letter-spacing:.2px}
  .bulb{
    width:28px;height:28px;border-radius:50%;
    position:relative;background:radial-gradient(circle at 35% 35%, #ffdca8 0 30%, var(--amber) 31%, #9c6610 100%);
    box-shadow:0 0 20px rgba(208,138,27,.35);
    flex:0 0 auto;
  }
  .bulb:after{
    content:""; position:absolute; bottom:-6px; left:50%; transform:translateX(-50%);
    width:16px; height:6px; border-radius:4px; background:var(--amber);
    box-shadow:0 -7px 0 0 var(--amber), 0 -14px 0 0 var(--amber);
  }
  h1{margin:.2rem 0;font-size:1.2rem}
  .subtitle{opacity:.9;margin-top:2px;font-size:.9rem}

  main{padding: 12px 14px; max-width:1100px; margin:0 auto;}
  .board{display:grid; gap:12px; grid-template-columns: 1fr;}
  @media (min-width: 940px){ .board{grid-template-columns: 360px 1fr;} }

  .panel{
    background:rgba(0,0,0,.14);
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px;
    padding:14px;
    box-shadow:0 8px 24px rgba(0,0,0,.12);
  }

  label{display:block;margin:.5rem 0 .25rem .1rem;opacity:.9;font-size:.95rem}
  select,button,input[type="range"]{
    width:100%;padding:14px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.14);
    background:#123c40;color:var(--cream);outline:none;font-size:1rem;
  }
  button.cta{
    background:linear-gradient(180deg,var(--amber),#b87a19);
    color:#231b14;border:none;font-weight:800;letter-spacing:.3px;cursor:pointer;
  }
  .row{display:flex; gap:8px; flex-wrap:wrap}
  .row > *{flex:1}

  .stats{display:flex; gap:8px; flex-wrap:wrap; margin:.6rem 0 0}
  .stat{background:#123c40;border:1px solid rgba(255,255,255,.12); padding:.45rem .6rem; border-radius:10px; font-weight:700; font-size:.95rem}

  /* Touch-friendly grid */
  .grid{display:grid; gap:10px; margin-top:10px; grid-template-columns: 1fr;}
  @media (min-width:560px){ .grid{grid-template-columns:1fr 1fr} }
  @media (min-width:1024px){ .grid{grid-template-columns:repeat(3,1fr)} }

  .card{
    background:#0c3134;
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px;
    padding:16px;
    min-height:60px;
    display:flex;align-items:center;justify-content:center;text-align:center;
    user-select:none; -webkit-user-select:none;
    touch-action:manipulation;
    transition: background .18s ease, transform .08s ease;
    font-size:1.02rem; line-height:1.3;
  }
  .card.term{background:#123c40}
  .card.definition{background:#0f2c2f}
  .card.selected{outline:3px solid var(--mint); transform:scale(0.995)}
  .card.correct{background:rgba(42,163,107,.2); border-color:rgba(42,163,107,.65)}
  .card.wrong{background:rgba(211,75,87,.18); border-color:rgba(211,75,87,.55)}

  .footer{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; opacity:.9}
  .hidden{display:none}

  .toast{
    position:fixed; bottom:18px; left:50%; transform:translateX(-50%);
    background:#102f33; border:1px solid rgba(255,255,255,.1);
    padding:.6rem .9rem; border-radius:12px; box-shadow:0 12px 24px rgba(0,0,0,.2);
    opacity:0; pointer-events:none; transition:.25s opacity, .25s transform;
    font-size:.95rem;
  }
  .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}

  .end-screen{ text-align:center; padding:24px 12px }
  .score-xl{font-size:2rem; font-weight:900; margin-top:6px}
  .pill{display:inline-block; padding:.25rem .6rem; border-radius:100px; background:#123c40; border:1px solid rgba(255,255,255,.15); margin:4px 4px}
  .muted{opacity:.75}

  /* Settings drawer */
  .drawer{
    position:fixed; right:0; top:0; height:100%; width:min(92vw, 420px);
    background:#0b3b3f; border-left:1px solid rgba(255,255,255,.12);
    box-shadow:-6px 0 24px rgba(0,0,0,.25);
    transform:translateX(100%); transition:.25s transform; z-index:30; padding:16px;
    overflow:auto;
  }
  .drawer.open{ transform:translateX(0) }
  .drawer h2{margin:6px 0 10px}
  .toggle{display:flex; align-items:center; justify-content:space-between; padding:10px 0; border-bottom:1px dashed rgba(255,255,255,.12)}

  /* Footer bar */
  .site-footer{
    margin:16px auto 22px;
    max-width:1100px;
    padding:10px 14px;
    display:flex; gap:8px; align-items:center; justify-content:center;
    opacity:.85; font-size:.92rem;
    border-top:1px solid rgba(255,255,255,.08);
  }
  .site-footer a{color:var(--mint); text-decoration:none}
  .site-footer a:hover{text-decoration:underline}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="bulb" aria-hidden="true"></div>
    <div>
      <div style="font-size:1.05rem">Sumptin‚Äô Scientific</div>
      <div class="subtitle">Match & Learn ‚Äî built for mobile</div>
    </div>
  </div>
  <div class="row" style="max-width:420px">
    <button id="shareBtn" title="Share" style="flex:0 0 auto;background:#123c40">Share</button>
    <button id="settingsBtn" title="Settings" style="flex:0 0 auto;background:#123c40">Settings</button>
  </div>
</header>

<main>
  <div class="board">
    <section class="panel">
      <h1>Choose Your Challenge</h1>
      <p class="subtitle">Tap to match terms with their definitions before time runs out. Bigger buttons, faster flow, pocket‚Äëfriendly.</p>

      <label for="subject">Subject</label>
      <select id="subject"></select>

      <label for="topic">Topic</label>
      <select id="topic"><option value="all">All topics</option></select>

      <div class="row">
        <div>
          <label for="difficulty">Difficulty</label>
          <select id="difficulty">
            <option value="easy">Easy ‚Äî more time, foundational terms</option>
            <option value="medium" selected>Medium ‚Äî balanced time, mixed terms</option>
            <option value="hard">Hard ‚Äî quick timer, advanced terms</option>
          </select>
        </div>
        <div>
          <label for="pairCount">Pairs per round</label>
          <select id="pairCount">
            <option value="6">6</option>
            <option value="8" selected>8</option>
            <option value="10">10</option>
            <option value="12">12</option>
          </select>
        </div>
      </div>

      <div class="stats">
        <div class="stat" id="timer">‚è±Ô∏è 00:00</div>
        <div class="stat" id="score">‚≠ê Score: 0</div>
        <div class="stat" id="streak">üî• Streak: 0</div>
        <div class="stat" id="highScore">üèÜ High: 0</div>
      </div>

      <div class="footer">
        <button class="cta" id="startBtn">Start Game</button>
        <div class="muted" id="pairsInfo"></div>
      </div>

      <div style="margin-top:10px">
        <h3 style="margin:.2rem 0">Device Leaderboard</h3>
        <div id="leaderboard" class="muted" style="font-size:.95rem"></div>
      </div>
    </section>

    <section class="panel">
      <div id="gameArea">
        <div class="grid" id="grid"></div>
        <div class="end-screen hidden" id="endScreen">
          <h2>Time!</h2>
          <div class="score-xl" id="finalScore">Score: 0</div>
          <p id="finalMsg" class="muted"></p>
          <div style="margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap">
            <button class="cta" id="playAgain">Play Again</button>
            <button id="revealAnswers" style="background:#123c40;border:1px solid rgba(255,255,255,.15);color:var(--cream);padding:12px 14px;border-radius:12px;font-size:1rem">Show Answer Key</button>
          </div>
          <div id="answerKey" class="hidden" style="text-align:left;margin-top:14px"></div>
        </div>
      </div>
    </section>
  </div>
</main>

<!-- Footer -->
<div class="site-footer">
  <span>Made for Sumptin‚Äô Scientific | ¬© 2025 Sumptin‚Äô Scientific | </span>
  <a href="https://www.sumptinscientific.com" target="_blank" rel="noopener noreferrer">www.sumptinscientific.com</a>
</div>

<!-- Settings Drawer -->
<aside class="drawer" id="drawer" aria-hidden="true" aria-label="Settings">
  <h2>Settings</h2>
  <div class="toggle">
    <span>Sound effects</span>
    <label>
      <input type="checkbox" id="soundToggle" checked />
      <span> On</span>
    </label>
  </div>
  <div class="toggle">
    <span>Timer multiplier</span>
    <div style="min-width:42%">
      <input type="range" id="timeMultiplier" min="0.5" max="1.5" step="0.1" value="1" />
      <div class="muted" id="timeMultLabel">1.0√ó</div>
    </div>
  </div>
  <div class="toggle">
    <span>Theme accent</span>
    <select id="themeAccent">
      <option value="mint" selected>Mint</option>
      <option value="amber">Amber</option>
      <option value="cream">Cream</option>
    </select>
  </div>
  <p class="muted" style="margin-top:10px">Tip: To enable a global leaderboard or head‚Äëto‚Äëhead play, connect to a small backend (Google Sheets + Apps Script works). See the inline comment in the code.</p>
</aside>

<div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
/* ------------------------ DATA ------------------------
  Subjects with topics and tagged terms for variety and replay.
  Each item: {term, def, diff, topics:[...]}
-------------------------------------------------------*/
const DATA = {
  "Cell Biology": [
    {term:"Mitochondrion", def:"Organelle that produces ATP via oxidative phosphorylation.", diff:"easy", topics:["organelles","metabolism"]},
    {term:"Ribosome", def:"Molecular machine that synthesizes proteins from mRNA.", diff:"easy", topics:["organelles","protein synthesis"]},
    {term:"Endoplasmic Reticulum", def:"Membrane network for protein and lipid processing.", diff:"medium", topics:["organelles","protein synthesis"]},
    {term:"Golgi Apparatus", def:"Stacked membranes that modify and sort proteins and lipids.", diff:"medium", topics:["organelles","secretion"]},
    {term:"Lysosome", def:"Acidic vesicle that digests macromolecules and debris.", diff:"easy", topics:["organelles","degradation"]},
    {term:"Peroxisome", def:"Performs fatty acid oxidation and detoxifies H2O2.", diff:"medium", topics:["organelles","metabolism"]},
    {term:"Cytoskeleton", def:"Filament network providing structure and movement.", diff:"easy", topics:["cytoskeleton"]},
    {term:"Actin", def:"Thin filaments for shape, motility, contraction.", diff:"medium", topics:["cytoskeleton"]},
    {term:"Microtubule", def:"Hollow tubulin polymers for transport and mitosis.", diff:"hard", topics:["cytoskeleton","cell division"]},
    {term:"Signal Peptide", def:"N‚Äëterminal sequence directing proteins to ER.", diff:"hard", topics:["protein targeting"]},
    {term:"Autophagy", def:"Self‚Äëdigestion pathway recycling cytoplasmic material.", diff:"hard", topics:["degradation"]},
    {term:"Exocytosis", def:"Vesicle fusion releasing cargo outside the cell.", diff:"medium", topics:["secretion"]},
    {term:"Endocytosis", def:"Uptake of extracellular material via vesicles.", diff:"medium", topics:["trafficking"]}
  ],
  "Genetics": [
    {term:"Gene", def:"DNA sequence encoding a functional product.", diff:"easy", topics:["basics"]},
    {term:"Allele", def:"Alternate version of a gene at a locus.", diff:"easy", topics:["basics"]},
    {term:"Genotype", def:"Genetic makeup at one or more loci.", diff:"easy", topics:["basics"]},
    {term:"Phenotype", def:"Observable trait from genotype and environment.", diff:"easy", topics:["basics"]},
    {term:"Homozygous", def:"Two identical alleles at a locus.", diff:"medium", topics:["inheritance"]},
    {term:"Heterozygous", def:"Two different alleles at a locus.", diff:"medium", topics:["inheritance"]},
    {term:"Linkage Disequilibrium", def:"Non‚Äërandom association of alleles at loci.", diff:"hard", topics:["population genetics"]},
    {term:"Penetrance", def:"Probability a genotype expresses its phenotype.", diff:"hard", topics:["inheritance"]},
    {term:"Epistasis", def:"Effect of one gene depends on another.", diff:"hard", topics:["inheritance"]},
    {term:"CRISPR‚ÄëCas9", def:"Guide RNA and nuclease used to edit DNA.", diff:"medium", topics:["genome editing"]},
    {term:"Promoter", def:"DNA sequence where RNA polymerase binds to start transcription.", diff:"medium", topics:["gene regulation"]},
    {term:"Enhancer", def:"Regulatory DNA that increases gene transcription.", diff:"hard", topics:["gene regulation"]}
  ],
  "Microbiology": [
    {term:"Gram‚Äëpositive", def:"Thick peptidoglycan cell wall; retains crystal violet.", diff:"easy", topics:["bacteria"]},
    {term:"Gram‚Äënegative", def:"Outer membrane with LPS; thin peptidoglycan.", diff:"easy", topics:["bacteria"]},
    {term:"Facultative Anaerobe", def:"Grows with or without oxygen.", diff:"medium", topics:["metabolism"]},
    {term:"Obligate Aerobe", def:"Requires oxygen for growth.", diff:"easy", topics:["metabolism"]},
    {term:"Biofilm", def:"Microbial community in extracellular matrix.", diff:"medium", topics:["ecology"]},
    {term:"Quorum Sensing", def:"Density‚Äëdependent regulation of gene expression.", diff:"hard", topics:["signaling"]},
    {term:"Plaque Assay", def:"Quantifies infectious phage/viruses.", diff:"hard", topics:["virology"]},
    {term:"Endospore", def:"Dormant, tough structure in some bacteria.", diff:"medium", topics:["bacteria"]},
    {term:"LPS (Endotoxin)", def:"Triggers inflammation from Gram‚Äënegatives.", diff:"hard", topics:["immunology"]}
  ],
  "Human Anatomy & Physiology": [
    {term:"Homeostasis", def:"Stable internal conditions via feedback.", diff:"easy", topics:["basics"]},
    {term:"Action Potential", def:"Rapid depolarization/repolarization in neurons.", diff:"medium", topics:["neuro"]},
    {term:"Sarcomere", def:"Contractile unit of striated muscle.", diff:"medium", topics:["muscle"]},
    {term:"Alveoli", def:"Tiny lung sacs for gas exchange.", diff:"easy", topics:["respiratory"]},
    {term:"Nephron", def:"Functional unit of the kidney.", diff:"medium", topics:["renal"]},
    {term:"Insulin", def:"Hormone that lowers blood glucose.", diff:"easy", topics:["endocrine"]},
    {term:"SA Node", def:"Pacemaker initiating heartbeat.", diff:"hard", topics:["cardio"]},
    {term:"Blood‚ÄëBrain Barrier", def:"Selective barrier protecting CNS.", diff:"hard", topics:["neuro"]}
  ],
  "Biochemistry": [
    {term:"Glycolysis", def:"Pathway converting glucose to pyruvate with ATP gain.", diff:"easy", topics:["metabolism"]},
    {term:"TCA Cycle", def:"Mitochondrial cycle oxidizing acetyl‚ÄëCoA; produces NADH/FADH2.", diff:"medium", topics:["metabolism"]},
    {term:"Oxidative Phosphorylation", def:"ATP synthesis driven by proton gradient.", diff:"hard", topics:["metabolism"]},
    {term:"Michaelis‚ÄìMenten Km", def:"Substrate concentration at half Vmax.", diff:"medium", topics:["enzymes"]},
    {term:"Allosteric Regulation", def:"Effector binding changes enzyme activity.", diff:"medium", topics:["enzymes"]},
    {term:"Beta‚Äëoxidation", def:"Catabolism of fatty acids into acetyl‚ÄëCoA.", diff:"hard", topics:["metabolism"]}
  ],
  "Ecology": [
    {term:"Carrying Capacity", def:"Max population size environment can sustain.", diff:"easy", topics:["populations"]},
    {term:"Niche", def:"Role and position a species has in its environment.", diff:"easy", topics:["communities"]},
    {term:"Keystone Species", def:"Disproportionate effect on community structure.", diff:"medium", topics:["communities"]},
    {term:"Trophic Level", def:"Position in a food chain.", diff:"easy", topics:["energy"]},
    {term:"Primary Succession", def:"Colonization of lifeless area; no soil initially.", diff:"medium", topics:["succession"]},
    {term:"Eutrophication", def:"Nutrient enrichment causing algal blooms.", diff:"medium", topics:["aquatic"]}
  ],
  "Neuroscience": [
    {term:"Synapse", def:"Junction where neurons communicate.", diff:"easy", topics:["cells"]},
    {term:"Neurotransmitter", def:"Chemical messenger released by neurons.", diff:"easy", topics:["chemistry"]},
    {term:"Long‚Äëterm Potentiation", def:"Persistent strengthening of synapses.", diff:"hard", topics:["plasticity"]},
    {term:"Myelin", def:"Insulating sheath that speeds conduction.", diff:"medium", topics:["cells"]},
    {term:"Dopamine", def:"Modulator of reward, motivation, movement.", diff:"medium", topics:["chemistry"]},
    {term:"Glia", def:"Support cells incl. astrocytes, oligodendrocytes, microglia.", diff:"medium", topics:["cells"]}
  ]
};

/* ---------------------- Utility helpers ---------------------- */
const subjectSel = document.getElementById('subject');
const topicSel = document.getElementById('topic');
const difficultySel = document.getElementById('difficulty');
const pairCountSel = document.getElementById('pairCount');
const startBtn = document.getElementById('startBtn');
const grid = document.getElementById('grid');
const timerEl = document.getElementById('timer');
const scoreEl = document.getElementById('score');
const streakEl = document.getElementById('streak');
const highScoreEl = document.getElementById('highScore');
const pairsInfo = document.getElementById('pairsInfo');
const toast = document.getElementById('toast');
const endScreen = document.getElementById('endScreen');
const finalScore = document.getElementById('finalScore');
const finalMsg = document.getElementById('finalMsg');
const playAgain = document.getElementById('playAgain');
const revealAnswersBtn = document.getElementById('revealAnswers');
const answerKey = document.getElementById('answerKey');
const shareBtn = document.getElementById('shareBtn');
const settingsBtn = document.getElementById('settingsBtn');
const drawer = document.getElementById('drawer');
const soundToggle = document.getElementById('soundToggle');
const timeMultiplier = document.getElementById('timeMultiplier');
const timeMultLabel = document.getElementById('timeMultLabel');
const themeAccent = document.getElementById('themeAccent');
const leaderEl = document.getElementById('leaderboard');

/* Sounds (tiny data URIs) */
const snd = {
  correct: new Audio('data:audio/wav;base64,UklGRkQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAAAAACAgICA/////w8PDw8PDw8P'),
  wrong:   new Audio('data:audio/wav;base64,UklGRkQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAAAAACAgP///wAAAP///w8PDw8P'),
  tick:    new Audio('data:audio/wav;base64,UklGRkQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAAAAACAgICAgICAgICAgICAgICA'),
  end:     new Audio('data:audio/wav;base64,UklGRkQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAAAAACAgP8AAP8A//////8AAA==')
};
Object.values(snd).forEach(a=>{ a.volume = 0.25; });

/* Theme accent */
themeAccent.addEventListener('change', () => {
  document.documentElement.style.setProperty('--mint',
    themeAccent.value==='amber' ? '#d08a1b' :
    themeAccent.value==='cream' ? '#f6ecd6' : '#6ab9b6'
  );
});

/* Share */
shareBtn.addEventListener('click', async () => {
  const url = location.href;
  const title = "Sumptin‚Äô Scientific ‚Äî Match & Learn";
  const text = "Test your biology & science knowledge in this quick, fun matching game!";
  if (navigator.share){
    try{ await navigator.share({title, text, url}); }catch(e){/* user cancelled */}
  }else{
    try{
      await navigator.clipboard.writeText(url);
      ping("Link copied to clipboard!");
    }catch{ ping("Share this link: "+url); }
  }
});

/* Settings drawer */
settingsBtn.addEventListener('click', () => {
  drawer.classList.toggle('open');
  drawer.setAttribute('aria-hidden', drawer.classList.contains('open') ? 'false' : 'true');
});
timeMultiplier.addEventListener('input', () => {
  timeMultLabel.textContent = `${Number(timeMultiplier.value).toFixed(1)}√ó`;
});

/* Populate subjects and topics */
function initSubjects(){
  Object.keys(DATA).forEach(k => {
    const opt = document.createElement('option');
    opt.value = k; opt.textContent = k;
    subjectSel.appendChild(opt);
  });
  subjectSel.selectedIndex = 0;
  refreshTopics();
}
function refreshTopics(){
  topicSel.innerHTML = '<option value="all">All topics</option>';
  const subj = subjectSel.value;
  const topicSet = new Set();
  (DATA[subj] || []).forEach(item => (item.topics||[]).forEach(t=>topicSet.add(t)));
  Array.from(topicSet).sort().forEach(t => {
    const opt = document.createElement('option');
    opt.value = t; opt.textContent = t.charAt(0).toUpperCase() + t.slice(1);
    topicSel.appendChild(opt);
  });
}
subjectSel.addEventListener('change', refreshTopics);

/* Core game state */
let state = { pairs: [], timeLeft: 0, timerId: null, score: 0, streak: 0, selected: null };
let cfg = {};

function difficultyConfig(level){
  switch(level){
    case 'easy': return { base: 100, penalty: 10, timePerPair: 18 };
    case 'medium': return { base: 120, penalty: 15, timePerPair: 11 };
    case 'hard': return { base: 150, penalty: 20, timePerPair: 7 };
  }
}
function selectPairs(list, level, n, topic){
  const filtered = (topic && topic!=='all') ? list.filter(i => (i.topics||[]).includes(topic)) : list.slice();
  // weight by difficulty proximity
  const weight = {easy:3, medium:2, hard:1};
  const pool = [];
  filtered.forEach(item=>{
    const w = item.diff===level ? weight.easy : (item.diff==='medium'?2:1);
    for(let k=0;k<w;k++) pool.push(item);
  });
  // unique picks
  const uniq = new Map();
  while(uniq.size < Math.min(n, filtered.length)){
    const pick = pool[Math.floor(Math.random()*pool.length)] || filtered[Math.floor(Math.random()*filtered.length)];
    uniq.set(pick.term, pick);
  }
  return Array.from(uniq.values());
}

function createCards(pairs){
  grid.innerHTML='';
  endScreen.classList.add('hidden');
  const terms = pairs.map(p=>({kind:'term', text:p.term}));
  const defs  = pairs.map(p=>({kind:'definition', text:p.def, match:p.term}));
  const shuf = a => a.sort(()=>Math.random()-0.5);
  shuf(terms); shuf(defs);
  const cards = terms.concat(defs);
  const frag = document.createDocumentFragment();
  cards.forEach(c=>{
    const el = document.createElement('div');
    el.className='card '+c.kind;
    el.textContent=c.text;
    el.dataset.kind=c.kind;
    if(c.kind==='definition') el.dataset.match=c.match;
    if(c.kind==='term') el.dataset.term=c.text;
    frag.appendChild(el);
  });
  grid.appendChild(frag);
}

function onCardClick(e){
  const el = e.target.closest('.card');
  if(!el) return;
  if(el.classList.contains('correct')) return;

  if(!state.selected){
    state.selected = el;
    el.classList.add('selected');
    return;
  }
  if(state.selected===el) return;

  const a = state.selected, b = el;
  if(a.dataset.kind===b.dataset.kind){
    a.classList.remove('selected');
    state.selected = b;
    b.classList.add('selected');
    return;
  }
  const termEl = a.dataset.kind==='term'? a : b;
  const defEl  = a.dataset.kind==='definition'? a : b;

  const isMatch = defEl.dataset.match === termEl.dataset.term;
  a.classList.remove('selected'); b.classList.remove('selected');
  if(isMatch){
    termEl.classList.add('correct');
    defEl.classList.add('correct');
    state.score += cfg.base + 10*state.streak;
    state.streak += 1;
    updateStats();
    if(soundToggle.checked) snd.correct.currentTime=0, snd.correct.play();
    ping(`+${cfg.base + 10*(state.streak-1)} points!`);
    if([...document.querySelectorAll('.card.term')].every(x=>x.classList.contains('correct'))){
      endGame();
    }
  }else{
    termEl.classList.add('wrong'); defEl.classList.add('wrong');
    setTimeout(()=>{ termEl.classList.remove('wrong'); defEl.classList.remove('wrong'); }, 350);
    state.score = Math.max(0, state.score - cfg.penalty);
    state.streak = 0;
    updateStats();
    if(soundToggle.checked) snd.wrong.currentTime=0, snd.wrong.play();
    ping(`-${cfg.penalty} points`, true);
  }
  state.selected = null;
}

function updateStats(){
  scoreEl.textContent = `‚≠ê Score: ${state.score}`;
  streakEl.textContent = `üî• Streak: ${state.streak}`;
}

function startTimer(totalSeconds){
  state.timeLeft = Math.max(10, Math.round(totalSeconds * Number(timeMultiplier.value)));
  timerEl.textContent = fmtTime(state.timeLeft);
  clearInterval(state.timerId);
  state.timerId = setInterval(()=>{
    state.timeLeft -= 1;
    if(state.timeLeft<=5 && soundToggle.checked){ snd.tick.currentTime=0; snd.tick.play(); }
    timerEl.textContent = fmtTime(state.timeLeft);
    if(state.timeLeft<=0){
      clearInterval(state.timerId);
      endGame();
    }
  }, 1000);
}

function fmtTime(s){
  const m = Math.floor(s/60).toString().padStart(2,'0');
  const ss = (s%60).toString().padStart(2,'0');
  return `‚è±Ô∏è ${m}:${ss}`;
}

function ping(msg, danger=false){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.style.borderColor = danger ? 'rgba(211,75,87,.6)' : 'rgba(42,163,107,.6)';
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 900);
}

/* Local storage keys */
function keyHigh(subj, level, topic){ return `SS_high_${subj}_${level}_${topic||'all'}`; }
function keyStreak(subj, level, topic){ return `SS_beststreak_${subj}_${level}_${topic||'all'}`; }
function keyHistory(){ return `SS_history`; }

function updateHighUI(subj, level, topic){
  const hs = Number(localStorage.getItem(keyHigh(subj, level, topic))||0);
  highScoreEl.textContent = `üèÜ High: ${hs}`;
}
function pushHistory(entry){
  const arr = JSON.parse(localStorage.getItem(keyHistory())||'[]');
  arr.unshift(entry);
  if(arr.length>12) arr.length = 12;
  localStorage.setItem(keyHistory(), JSON.stringify(arr));
  renderLeaderboard(arr);
}
function renderLeaderboard(arr){
  const data = arr || JSON.parse(localStorage.getItem(keyHistory())||'[]');
  leaderEl.innerHTML = data.length ?
    data.map(e=>`<div class="pill">${e.date} ‚Ä¢ ${e.subj}${e.topic!=='all'?'/'+e.topic:''} ‚Ä¢ ${e.level} ‚Ä¢ Score ${e.score} ‚Ä¢ Streak ${e.streak}</div>`).join(' ')
    : '<span class="muted">No scores yet ‚Äî start a game!</span>';
}

/* Start/setup */
function setupGame(){
  const subj = subjectSel.value;
  const topic = topicSel.value || 'all';
  const level = difficultySel.value;
  const pairsWanted = Number(pairCountSel.value);
  cfg = difficultyConfig(level);

  const chosen = selectPairs(DATA[subj], level, pairsWanted, topic);
  state.pairs = chosen;
  state.score = 0; state.streak = 0; state.selected=null;
  updateStats();
  createCards(chosen);
  const totalTime = cfg.timePerPair * chosen.length;
  startTimer(totalTime);
  updateHighUI(subj, level, topic);
  pairsInfo.textContent = `Pairs: ${chosen.length} ‚Ä¢ ${subj}${topic!=='all'?' / '+topic:''}`;
  grid.onclick = onCardClick;
  document.getElementById('gameArea').scrollIntoView({behavior:'smooth', block:'start'});
}

function endGame(){
  grid.innerHTML='';
  endScreen.classList.remove('hidden');
  finalScore.textContent = `Score: ${state.score}`;
  const subj = subjectSel.value;
  const level = difficultySel.value;
  const topic = topicSel.value || 'all';
  const kH = keyHigh(subj, level, topic);
  const kS = keyStreak(subj, level, topic);
  const prevH = Number(localStorage.getItem(kH)||0);
  const prevS = Number(localStorage.getItem(kS)||0);

  if(state.score > prevH){
    localStorage.setItem(kH, state.score);
    finalMsg.textContent = "New high score! Stellar work. üöÄ";
  }else{
    finalMsg.textContent = `High score to beat: ${prevH} (best streak: ${prevS})`;
  }
  if(state.streak > prevS){
    localStorage.setItem(kS, state.streak);
  }
  updateHighUI(subj, level, topic);
  answerKey.innerHTML = '<h3>Answer Key</h3>' + state.pairs.map(p=>`<div class="pill"><strong>${p.term}</strong>: ${p.def}</div>`).join(' ');
  if(soundToggle.checked) snd.end.currentTime=0, snd.end.play();

  // Save history (device-only leaderboard)
  const now = new Date();
  pushHistory({
    date: now.toLocaleDateString(),
    subj, topic, level,
    score: state.score,
    streak: state.streak
  });
}

/* Global leaderboard / Versus mode (Optional backend)
   - Create a Google Sheet, and an Apps Script web app (doPost) that accepts JSON {name, score, subject, level, topic, timestamp}.
   - From here, POST fetch() to that URL on endGame().
   - To show a global leaderboard, fetch the Sheet data in read-only endpoint and render in a table.
   - For real-time head‚Äëto‚Äëhead, use a lightweight signaling service (Ably / Pusher channels) to pair two clients and send match state.
*/

/* Events */
document.getElementById('startBtn').addEventListener('click', setupGame);
document.getElementById('playAgain').addEventListener('click', setupGame);
document.getElementById('revealAnswers').addEventListener('click', ()=>{
  answerKey.classList.toggle('hidden');
});

/* Init */
initSubjects();
renderLeaderboard();
pairsInfo.textContent = "Pairs: ‚Äî ‚Ä¢ Subject: ‚Äî";
</script>
</body>
</html>
"""
path = "/mnt/data/ss_match_game_pro.html"
with open(path, "w", encoding="utf-8") as f:
    f.write(html)
path
